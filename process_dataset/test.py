from androguard.misc import AnalyzeAPK
from pruning_graph import GraphPruning
from typing import List
# a, _, dx = AnalyzeAPK('dataset/raw/train/Adware0001.apk')
# cg = dx.get_call_graph()
# GraphPruning._get_pscout_api(
#     'process_dataset/sensitive_apis/pscoutApi.txt')
# print(cg)
# print(GraphPruning._pruning_graph(cg, 4))
with open("process_dataset\sensitive_apis\pscoutRaw.txt", 'r') as file:
    lines = file.readlines()


def get_parameters(inputList: List[str]) -> str:
    parameters = ''
    mapping_char = {
        "I": "int",
        "Z": "boolean",
        "B": "byte",
        "J": "long",
        "F": "float",
        "D": "double",
        "C": "char",
        "S": "short"
    }
    for current_str in inputList:
        tmp_array = ''
        if not current_str:
            continue
        # if current_str[0] == '[':
        #     while True:
        #         if current_str[0] != '[':
        #             break
        #         tmp_array += '[]'
        #         current_str = current_str[1:]
        # print(current_str[0])
        if current_str[0] == 'L':
            parameters += f',{current_str[1:]}{tmp_array}'
            continue
        else:
            for i in current_str:
                if i != '[':
                    if i == 'L':
                        f',{current_str[1:]}{tmp_array}'
                        tmp_array = ''
                        break
                    parameters += f',{mapping_char[i]}{tmp_array}'
                    tmp_array = ''
                else:
                    tmp_array += '[]'
                current_str = current_str[1:]

    return parameters[1:]


# fileWrite = open('process_dataset/sensitive_apis/pscoutApi2.txt', 'a')
# for line in lines:
#     line = line.replace("/", '.')
#     line_element = line.split('->')
#     class_name = line_element[0][1:-1]
#     method = line_element[1].split('(')[0]
#     parameter_list = line_element[1].split('(')[1].split(')')[0].split(";")
#     print(parameter_list)
#     fileWrite.write(
#         f'|{class_name}| |{method}| |{get_parameters(parameter_list)}|\n')

file1 = open('process_dataset/sensitive_apis/pscoutApi.txt', 'r')
file2 = open('process_dataset/sensitive_apis/pscoutApi2.txt', 'r')

lines1 = file1.readlines()
lines2 = file2.readlines()

file1.close()
file2.close()

listUnit = set(lines1) | set(lines2)
print("Union of two files:", len(listUnit))

# for line in lines1:
#     print(line)

print("Number of lines in file2:", len(lines2))
with open('process_dataset/sensitive_apis/pscoutApiUnion.txt', 'a') as f:
    for line in listUnit:
        f.write(line)
